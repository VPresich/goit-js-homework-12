{"version":3,"file":"commonHelpers3.js","sources":["../src/js/common/load-image.js","../src/js/task-8-1/modal-window-slider.js","../src/js/task-8-1/modal-window-handles.js"],"sourcesContent":["function loadImage(sourceImg) {\n  return new Promise((resolve, reject) => {\n    const image = new Image();\n    image.src = sourceImg;\n    image.onload = () => {\n      resolve(image);\n    };\n    image.onerror = error => {\n      reject(error);\n    };\n  });\n}\n\nexport default loadImage;\n","import SliderInterface from '../common/slider-interface.js';\nimport { DEFAULT_URL, DEFAULT_ALT } from '../common/constants';\nimport loadImage from '../common/load-image.js';\nclass ModalWindowSlider extends SliderInterface {\n  #sliderContent;\n  #elementsList;\n  #loader;\n  constructor(params) {\n    const { elementsList, sliderContent } = params;\n    super(params);\n    this.#elementsList = elementsList;\n    this.#sliderContent = sliderContent;\n    this.#loader = document.querySelector('.border-loader-modal-window');\n    this.#loader.style.display = 'block';\n    this.update();\n  }\n\n  destroy() {\n    super.destroy();\n    this.deleteImage();\n  }\n\n  async updateContent() {\n    this.#loader.style.display = 'block';\n    document.body.style.cursor = 'none';\n\n    const slideNumber = super.getCurrentSlide();\n    const imgRef = this.#elementsList[slideNumber].querySelector('img');\n    const aRef = this.#elementsList[slideNumber].querySelector('a');\n\n    const sourceImg = imgRef.dataset.source\n      ? imgRef.dataset.source\n      : aRef.href\n      ? aRef.href\n      : imgRef.src;\n\n    try {\n      const loadedImage = await loadImage(sourceImg);\n      this.#sliderContent.src = loadedImage.src;\n      this.#sliderContent.alt = imgRef.alt;\n    } catch (error) {\n      this.#sliderContent.src = DEFAULT_URL;\n      this.#sliderContent.alt = DEFAULT_ALT;\n      console.log(error);\n    } finally {\n      this.#loader.style.display = 'none';\n      document.body.style.cursor = 'default';\n    }\n  }\n\n  deleteImage() {\n    this.#sliderContent.src = '';\n    this.#sliderContent.alt = '';\n  }\n}\nexport default ModalWindowSlider;\n","import { KEY_CODE_ESC } from '../common/constants.js';\n\nimport ModalWindowSlider from './modal-window-slider.js';\nimport createCardsGallery from '../common/create-cards-gallery.js';\nimport getImages from '../common/get-images.js';\n\nimport { createErrMsg } from '../common/create-msg.js';\nimport {\n  BGR_GALLERY,\n  BGR_BODY,\n  DEF_ELEMENT_PERPAGE,\n} from '../common/constants.js';\n\nimport GalleryPagination from '../common/gallery-pagination.js';\n\nlet searchString = '';\n\nconst refs = {\n  gallery: document.querySelector('.gallery'),\n  modalBackdrop: document.querySelector('.modal-backdrop'),\n  buttonClose: document.querySelector('.close-button'),\n  modalContent: document.querySelector('.modal-content'),\n  modalClose: document.querySelector('#closeBtn'),\n  loader: document.querySelector('.border-loader'),\n  searchForm: document.querySelector('.search-form'),\n};\n\nrefs.gallery.addEventListener('click', onGalleryImageClick);\nrefs.buttonClose.addEventListener('click', onCloseModalWindow);\nrefs.modalBackdrop.addEventListener('click', onBackdropClick);\nrefs.modalClose.addEventListener('click', onCloseModalWindow);\nrefs.searchForm.addEventListener('submit', onSearchFormSubmit);\n\nconst galleryPagination = new GalleryPagination({\n  data: [],\n  fnCreateMarkup: createCardsGallery,\n  fnGetImages: getImages,\n  contentRef: refs.gallery,\n  elementsPerPage: DEF_ELEMENT_PERPAGE,\n  searchStr: searchString,\n});\n\nlet modalWindowSlider;\nconst dataForSlider = {\n  slidesPerPage: 1,\n  prevBtnId: 'prevBtn',\n  nextBtnId: 'nextBtn',\n  dotsContainerId: 'sliderDots',\n  sliderContainerId: 'modalContent',\n  slidesCounterId: 'slidesCounter',\n  dotDefaultClass: 'slider-dot',\n  dotActiveClass: 'active-dot',\n  isDotContainText: false,\n  sliderContent: refs.modalContent,\n};\n\nfunction onGalleryImageClick(event) {\n  event.preventDefault();\n  const targetRef = event.target;\n\n  const isImageRef =\n    targetRef.classList.contains('card-cover') ||\n    targetRef.classList.contains('card-cover-darkened');\n\n  if (!isImageRef) {\n    return;\n  }\n\n  const closestLi = targetRef.closest('li');\n  const listImages = event.currentTarget.children;\n  const indexList = Array.from(listImages).indexOf(closestLi);\n\n  modalWindowSlider = new ModalWindowSlider({\n    ...dataForSlider,\n    currentSlide: indexList,\n    elementsList: listImages,\n    elementsListLength: listImages.length,\n  });\n\n  openModalWindow();\n}\n\nfunction onSearchFormSubmit(event) {\n  event.preventDefault();\n  searchString = event.currentTarget.search.value.trim();\n  refs.loader.style.display = 'block';\n\n  getImages(searchString, 1)\n    .then(images => {\n      refreshOnSuccess(images);\n    })\n    .catch(error => {\n      refreshOnError(error);\n    })\n    .finally(() => {\n      refs.searchForm.search.value = '';\n      refs.loader.style.display = 'none';\n    });\n}\n\nfunction openModalWindow() {\n  refs.modalBackdrop.classList.add('is-open');\n  window.addEventListener('keydown', onWindowKeydown);\n}\n\nfunction onCloseModalWindow(event) {\n  window.removeEventListener('keydown', onWindowKeydown);\n  refs.modalBackdrop.classList.remove('is-open');\n  modalWindowSlider.destroy();\n}\n\nfunction onWindowKeydown(event) {\n  if (event.code === KEY_CODE_ESC) {\n    onCloseModalWindow(event);\n  }\n}\n\nfunction onBackdropClick(event) {\n  if (event.currentTarget === event.target) {\n    onCloseModalWindow(event);\n  }\n}\n\nfunction refreshOnError(msg) {\n  createErrMsg(msg);\n  refs.gallery.style.backgroundColor = BGR_BODY;\n  galleryPagination && galleryPagination.refresh();\n}\n\nfunction refreshOnSuccess(data) {\n  refs.gallery.style.backgroundColor = BGR_GALLERY;\n\n  galleryPagination && galleryPagination.refresh();\n\n  const maxPages = Math.ceil(data.totalHits / DEF_ELEMENT_PERPAGE);\n  galleryPagination.addData(data.hits, maxPages, searchString);\n}\n"],"names":["loadImage","sourceImg","resolve","reject","image","error","ModalWindowSlider","SliderInterface","params","elementsList","sliderContent","__privateAdd","_sliderContent","_elementsList","_loader","__privateSet","__privateGet","slideNumber","imgRef","aRef","loadedImage","DEFAULT_URL","DEFAULT_ALT","searchString","refs","onGalleryImageClick","onCloseModalWindow","onBackdropClick","onSearchFormSubmit","galleryPagination","GalleryPagination","createCardsGallery","getImages","DEF_ELEMENT_PERPAGE","modalWindowSlider","dataForSlider","event","targetRef","closestLi","listImages","indexList","openModalWindow","images","refreshOnSuccess","refreshOnError","onWindowKeydown","KEY_CODE_ESC","msg","createErrMsg","BGR_BODY","data","BGR_GALLERY","maxPages"],"mappings":"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"}